<!doctype html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>DimObl ‚Äî –ê–¥–º—ñ–Ω</title>

<style>
:root{
  --bg:#0f1115; --card:#171a21; --text:#e9eef7; --muted:#9aa7bd;
  --border:#2a3140; --btn:#21c55d; --btnText:#06120a;
  --btn2:#0f1218;
}
[data-theme="light"]{
  --bg:#f5f7fb; --card:#ffffff; --text:#0f172a; --muted:#5b677a;
  --border:#dbe3ef; --btn:#16a34a; --btnText:#ffffff;
  --btn2:#f3f6fb;
}

body{
  margin:0;
  font-family:system-ui,Segoe UI,Arial;
  background:var(--bg);
  color:var(--text);
}

.wrap{
  min-height:100vh;
  display:flex;
  align-items:flex-start;
  justify-content:center;
  padding:18px;
}

.card{
  width:min(520px,100%);
  background:var(--card);
  border:1px solid var(--border);
  border-radius:18px;
  padding:22px;
}

.top{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:14px;
}

.brand{
  font-weight:800;
  font-size:26px;
}

.muted{
  color:var(--muted);
  font-size:13px;
}

.grid{
  display:flex;
  flex-direction:column;
  gap:14px;
  margin-top:18px;
}

/* —Ä—è–¥–æ–∫ –∑ –∫–Ω–æ–ø–∫–æ—é + –∫–æ–Ω—Ç—Ä–æ–ª–∞–º–∏ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è */
.catRow{
  display:flex;
  gap:10px;
  align-items:center;
}

button{
  padding:16px;
  border-radius:14px;
  border:1px solid var(--border);
  background:var(--btn2);
  color:var(--text);
  font-size:16px;
  font-weight:700;
  cursor:pointer;
  transition:.15s;
  text-align:left;
}

button:hover{
  transform:translateY(-1px);
  box-shadow:0 6px 20px rgba(0,0,0,.25);
}

button.main{
  background:var(--btn);
  color:var(--btnText);
  border:0;
}

/* –º–∞–ª–µ–Ω—å–∫—ñ –∫–Ω–æ–ø–∫–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è (‚¨Ü‚¨áüóë) */
button.ctrl{
  width:54px;
  padding:14px 0;
  text-align:center;
}

.footer{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-top:18px;
}

/* –ø–∞–Ω–µ–ª—å –¥–æ–¥–∞–≤–∞–Ω–Ω—è */
.editBox{
  display:none;
  margin-top:14px;
}
.editRow{
  display:flex;
  gap:10px;
  align-items:center;
}
.editInput{
  flex:1;
  padding:14px;
  border-radius:12px;
  border:1px solid var(--border);
  background:var(--btn2);
  color:var(--text);
  outline:none;
  box-sizing:border-box;
}
</style>
</head>

<body>
<div class="wrap">
  <div class="card">

    <div class="top">
      <div>
        <div class="brand">üëë –ê–¥–º—ñ–Ω-–ü–∞–Ω–µ–ª—å</div>
        <div class="muted" id="user">‚Äî</div>
      </div>
      <button onclick="toggleTheme()">üåì</button>
    </div>

    <!-- –î–∏–Ω–∞–º—ñ—á–Ω–∏–π —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π -->
    <div class="grid" id="catGrid"></div>

    <!-- –ü–∞–Ω–µ–ª—å —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è -->
    <div class="editBox" id="editBox">
      <div class="editRow">
        <input id="newCat" class="editInput" placeholder="–ù–æ–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è (–Ω–∞–∑–≤–∞)">
        <button onclick="addCategory()" style="width:auto; padding:16px;">–î–æ–¥–∞—Ç–∏</button>
      </div>
      <div class="muted" style="margin-top:8px;">
        –†–µ–∂–∏–º —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è: ‚¨Ü‚¨á –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è, üóë –≤–∏–¥–∞–ª–µ–Ω–Ω—è
      </div>
    </div>

    <div class="footer">
      <button onclick="logout()">–í–∏–π—Ç–∏</button>
      <button class="main" onclick="toggleEdit()">–†–ï–î–ê–ì–£–í–ê–¢–ò</button>
    </div>

  </div>
</div>

<script>
/* ====== AUTH ====== */
const API_URL = "https://script.google.com/macros/s/AKfycbyX9sLQl6M7HftZhA1WccI_uo6JmxGm1DzifsFmVp4BzPcZQSyd8HixmQ-_igGZeryu/exec";
const REQUIRED_ROLE = "admin";

function logout(){
  localStorage.clear();
  location.href = "index.html";
}

(async function checkAccess(){
  const token = localStorage.getItem("dimobl_token");
  if (!token) return logout();

  try{
    const r = await fetch(`${API_URL}?action=check&token=${encodeURIComponent(token)}`);
    const d = await r.json();

    if (d.status !== "OK") return logout();

    const role = String(d.role).toLowerCase().trim();
    if (role !== REQUIRED_ROLE) return logout();

    document.getElementById("user").textContent = `${d.name} (${role})`;
  }catch{
    logout();
  }
})();

/* ====== CATEGORIES (editable) ====== */
const LS_KEY = "dimobl_categories";
let editMode = false;

// —Å—Ç–∞—Ä—Ç–æ–≤—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó (—è–∫—â–æ localStorage –ø—É—Å—Ç–∏–π)
const DEFAULT_CATS = [
  { id:"finance",  title:"üí∞ –§–Ü–ù–ê–ù–°–ò" },
  { id:"food",     title:"üçΩ –á–ñ–ê" },
  { id:"clothes",  title:"üëï –û–î–Ø–ì" },
  { id:"goals",    title:"üéØ –¶–Ü–õ–Ü" },
  { id:"tasks",    title:"üìù –ó–ê–í–î–ê–ù–ù–Ø" },
  { id:"notes",    title:"üìå –ü–†–ò–ú–Ü–¢–ö–ò" },
];

function loadCats(){
  try{
    const raw = localStorage.getItem(LS_KEY);
    if (!raw) return DEFAULT_CATS.slice();
    const arr = JSON.parse(raw);
    return Array.isArray(arr) && arr.length ? arr : DEFAULT_CATS.slice();
  }catch{
    return DEFAULT_CATS.slice();
  }
}

function saveCats(cats){
  localStorage.setItem(LS_KEY, JSON.stringify(cats));
}

function slugifyUA(s){
  return s.toLowerCase()
    .trim()
    .replace(/\s+/g, "_")
    .replace(/[^a-z0-9_\u0400-\u04FF]/g, "");
}

function renderCats(){
  const grid = document.getElementById("catGrid");
  const cats = loadCats();
  grid.innerHTML = "";

  cats.forEach((c, idx) => {
    const row = document.createElement("div");
    row.className = "catRow";

    const btn = document.createElement("button");
    btn.textContent = c.title;
    btn.style.flex = "1";
    btn.onclick = () => {
      if (editMode) return;
      go(c.id);
    };

    row.appendChild(btn);

    if (editMode){
      const up = document.createElement("button");
      up.className = "ctrl";
      up.textContent = "‚¨Ü";
      up.onclick = () => moveCat(idx, -1);

      const down = document.createElement("button");
      down.className = "ctrl";
      down.textContent = "‚¨á";
      down.onclick = () => moveCat(idx, +1);

      const del = document.createElement("button");
      del.className = "ctrl";
      del.textContent = "üóë";
      del.onclick = () => deleteCat(idx);

      row.appendChild(up);
      row.appendChild(down);
      row.appendChild(del);
    }

    grid.appendChild(row);
  });
}

function toggleEdit(){
  editMode = !editMode;
  document.getElementById("editBox").style.display = editMode ? "block" : "none";
  renderCats();
}

function addCategory(){
  const inp = document.getElementById("newCat");
  const name = (inp.value || "").trim();
  if (!name) return;

  const cats = loadCats();
  const id = slugifyUA(name);

  if (!id) return alert("–ù–µ–≤—ñ—Ä–Ω–∞ –Ω–∞–∑–≤–∞");
  if (cats.some(x => x.id === id)) return alert("–¢–∞–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è –≤–∂–µ —î");

  cats.push({ id, title: name });
  saveCats(cats);
  inp.value = "";
  renderCats();
}

function deleteCat(idx){
  const cats = loadCats();
  cats.splice(idx, 1);
  saveCats(cats);
  renderCats();
}

function moveCat(idx, dir){
  const cats = loadCats();
  const n = idx + dir;
  if (n < 0 || n >= cats.length) return;

  const tmp = cats[idx];
  cats[idx] = cats[n];
  cats[n] = tmp;

  saveCats(cats);
  renderCats();
}

/* ====== NAV ====== */
function go(section){
  alert("–ü–µ—Ä–µ—Ö—ñ–¥ —É —Ä–æ–∑–¥—ñ–ª: " + section);
  // –ø—ñ–∑–Ω—ñ—à–µ: location.href = section + ".html";
}

/* ====== THEME ====== */
function applyTheme(t){
  document.documentElement.setAttribute("data-theme", t);
  localStorage.setItem("dimobl_theme", t);
}
function toggleTheme(){
  const cur = localStorage.getItem("dimobl_theme") || "dark";
  applyTheme(cur === "dark" ? "light" : "dark");
}
applyTheme(localStorage.getItem("dimobl_theme") || "dark");

/* –ø–µ—Ä—à–∏–π —Ä–µ–Ω–¥–µ—Ä */
renderCats();
</script>

</body>
</html>
